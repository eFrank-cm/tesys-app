<script lang="ts">
    import * as Avatar from "$lib/components/ui/avatar/index.js";
    import * as DropdownMenu from "$lib/components/ui/dropdown-menu/index.js";
    import * as Sidebar from "$lib/components/ui/sidebar/index.js";
    import { useSidebar } from "$lib/components/ui/sidebar/index.js";
    import ChevronsUpDown from "@lucide/svelte/icons/chevrons-up-down";
    import LogOut from "@lucide/svelte/icons/log-out";
    import UserBagde from "./UserBagde.svelte";
    import { authStore } from "../store.svelte";

    interface NavUserProps {
        username: string;
        email: string;
        avatar?: string;
    }

    let { username, email, avatar }: NavUserProps = $props();

    const sidebar = useSidebar();

    // let letters = $derived.by(() => {
    //     return username
    //         ? username
    //               .split(" ")
    //               .map((n) => n[0])
    //               .join("")
    //               .toUpperCase()
    //         : "Inv";
    // });

    let letters = $derived.by(() => {
        return username ? username.trim().split(" ")[0][0].toUpperCase() : "I";
    });
</script>

<Sidebar.Menu>
    <Sidebar.MenuItem>
        <DropdownMenu.Root>
            <DropdownMenu.Trigger>
                {#snippet child({ props })}
                    <Sidebar.MenuButton
                        size="lg"
                        class="data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground"
                        {...props}
                    >
                        <UserBagde {username} {email} {avatar} />
                        <ChevronsUpDown class="ml-auto size-4" />
                    </Sidebar.MenuButton>
                {/snippet}
            </DropdownMenu.Trigger>
            <DropdownMenu.Content
                class="w-[var(--bits-dropdown-menu-anchor-width)] min-w-56 rounded-lg"
                side={sidebar.isMobile ? "bottom" : "right"}
                align="end"
                sideOffset={4}
            >
                <DropdownMenu.Label class="p-0 font-normal">
                    <div
                        class="flex items-center gap-2 px-1 py-1.5 text-left text-sm"
                    >
                        <UserBagde {username} {email} {avatar} />
                    </div>
                </DropdownMenu.Label>
                <DropdownMenu.Separator />
                <DropdownMenu.Item onclick={authStore.logout}>
                    <LogOut />
                    Cerrar Sesion
                </DropdownMenu.Item>
            </DropdownMenu.Content>
        </DropdownMenu.Root>
    </Sidebar.MenuItem>
</Sidebar.Menu>
